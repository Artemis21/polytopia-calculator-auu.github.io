!function(e){var n={};function t(a){if(n[a])return n[a].exports;var r=n[a]={i:a,l:!1,exports:{}};return e[a].call(r.exports,r,r.exports,t),r.l=!0,r.exports}t.m=e,t.c=n,t.d=function(e,n,a){t.o(e,n)||Object.defineProperty(e,n,{enumerable:!0,get:a})},t.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},t.t=function(e,n){if(1&n&&(e=t(e)),8&n)return e;if(4&n&&"object"==typeof e&&e&&e.__esModule)return e;var a=Object.create(null);if(t.r(a),Object.defineProperty(a,"default",{enumerable:!0,value:e}),2&n&&"string"!=typeof e)for(var r in e)t.d(a,r,(function(n){return e[n]}).bind(null,r));return a},t.n=function(e){var n=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(n,"a",n),n},t.o=function(e,n){return Object.prototype.hasOwnProperty.call(e,n)},t.p="",t(t.s="1aQb")}({"1aQb":function(e,n,t){"use strict";t.r(n);var a=function(){return(a=Object.assign||function(e){for(var n,t=1,a=arguments.length;t<a;t++)for(var r in n=arguments[t])Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r]);return e}).apply(this,arguments)},r={Warrior:{attack:2,defense:2,hp:10,veteranHp:15,defenseBonus:1.5,wallBonus:4},Rider:{attack:2,defense:1,hp:10,veteranHp:15,defenseBonus:1.5,wallBonus:4},Defender:{attack:1,defense:3,hp:15,veteranHp:20,defenseBonus:1.5,wallBonus:4},Swordsman:{attack:3,defense:3,hp:15,veteranHp:20,defenseBonus:1.5,wallBonus:4},Archer:{attack:2,defense:1,hp:10,veteranHp:15,defenseBonus:1.5,wallBonus:4},Catapult:{attack:4,defense:0,hp:10,veteranHp:15,defenseBonus:0,wallBonus:0},Knight:{attack:3.5,defense:1,hp:15,veteranHp:20,defenseBonus:1.5,wallBonus:4},Giant:{attack:5,defense:4,hp:40,veteranHp:null,defenseBonus:1.5,wallBonus:0},Boat:{attack:1,defense:1,hp:10,veteranHp:null,defenseBonus:1.5,wallBonus:0},Ship:{attack:2,defense:2,hp:10,veteranHp:null,defenseBonus:1.5,wallBonus:0},Battleship:{attack:4,defense:3,hp:10,veteranHp:null,defenseBonus:1.5,wallBonus:0},Amphibian:{attack:2,defense:1,hp:10,veteranHp:15,defenseBonus:1.5,wallBonus:4},Tridention:{attack:3,defense:1,hp:15,veteranHp:20,defenseBonus:1.5,wallBonus:4},Crab:{attack:4,defense:4,hp:40,veteranHp:null,defenseBonus:1.5,wallBonus:4},"Battle Sled":{attack:3,defense:2,hp:15,veteranHp:20,defenseBonus:1.5,wallBonus:4},Polytaur:{attack:3,defense:1,hp:15,veteranHp:null,defenseBonus:1.5,wallBonus:4},Navalon:{attack:4,defense:4,hp:30,veteranHp:null,defenseBonus:1.5,wallBonus:0},"Mind Bender":{attack:0,defense:1,hp:10,veteranHp:null,defenseBonus:1.5,wallBonus:0},"Ice Fortress":{attack:4,defense:3,hp:20,veteranHp:25,defenseBonus:1.5,wallBonus:4},"Ice Archer":{attack:.1,defense:1,hp:10,veteranHp:15,defenseBonus:1.5,wallBonus:4},"Dragon Egg":{attack:0,defense:2,hp:10,veteranHp:null,defenseBonus:1.5,wallBonus:4},"Baby Dragon":{attack:3,defense:3,hp:15,veteranHp:null,defenseBonus:1.5,wallBonus:0},"Fire Dragon":{attack:4,defense:3,hp:20,veteranHp:null,defenseBonus:1.5,wallBonus:0},Mooni:{attack:0,defense:2,hp:10,veteranHp:null,defenseBonus:1.5,wallBonus:0},"Nature Bunny":{attack:0,defense:1,hp:20,veteranHp:null,defenseBonus:0,wallBonus:0},Gaami:{attack:4,defense:4,hp:30,veteranHp:35,defenseBonus:1.5,wallBonus:4}},s=["Boat","Ship","Battleship"];function u(e){if(!e.unit)return null;var n;if(s.includes(e.unit)){if(!e.carriedUnit)return null;n=r[e.carriedUnit]}else n=r[e.unit];return e.isVeteran&&n.veteranHp?n.veteranHp:n.hp}function l(e){return JSON.parse(JSON.stringify(e))}function o(e){var n=[];if(0===e.length)return[];if(1===e.length)return[e];for(var t=0;t<e.length;t++)for(var a=e[t],r=o(e.slice(0,t).concat(e.slice(t+1))),s=0;s<r.length;s++){var u=[a].concat(r[s]);n.push(u)}return n}addEventListener("message",(function(e){var n,t,s,d,f,p,i,c,h=e.data;postMessage((n=h.attackers,t=h.defenders,p=(s=h.getOptimalResult)?o(n):[n],i=s?o(t):[t],d=i,f=[],p.forEach((function(e){d.forEach((function(n){f.push([e,n])}))})),(c=f).forEach((function(e){var n=function(e,n){var t=[],s=[],l=[],o=0;e.forEach((function(e){var l=n.findIndex((function(e){return e.hp>0}));if("number"!=typeof l||l<0)s.push(e);else{var d,f,p,i,c,h,v,B,k=n[l],g=(i=(p=function(e,n){var t=r[e.unit],a=r[n.unit],s=u(e),l=u(n),o=t.attack*(e.hp/s),d=a.defense*(n.hp/l);if(n.withDefenseBonus){var f="withWall"===n.withDefenseBonus?a.wallBonus:a.defenseBonus;f&&(d*=f)}var p=o+d,i=Math.round(o/p*t.attack*4.5),c=Math.round(d/p*a.defense*4.5),h=Math.max(n.hp-i,0),v=null;"Fire Dragon"===e.unit&&(v=Math.max(n.hp-Math.floor(i/2),0));var B=e.hp,k=e.freeFromRetaliation||["Mooni","Ice Archer"].includes(n.unit)||["Ice Archer"].includes(e.unit);return h>0&&!k?B=Math.max(e.hp-c,0):c=0,{attackDamage:i,defenseDamage:c,defenderNewHp:h,attackerNewHp:B,splashedNewHp:v}}(d=a({},e),f=a({},k))).attackDamage,c=p.defenseDamage,h=p.defenderNewHp,v=p.attackerNewHp,B=p.splashedNewHp,d.origHp=d.hp,d.newHp=v,d.attackDamage=Math.min(i,f.hp-h),f.origHp=f.hp,f.newHp=h,f.splashedNewHp=B,f.defenseDamage=Math.min(c,d.hp-v),{attacker:d,defender:f});o=l,k.preservedHp||(k.preservedHp=k.hp),k.hp=g.defender.newHp,t.push(g)}}));var d=n.slice(o+1),f=t[t.length-1].defender;return f.newHp>0&&l.push(f),{battleResults:t,unusedAttackerUnits:s,untouchedDefenderUnits:d,defenderSurvivors:l}}(l(e[0]),l(e[1])),t=n.battleResults,s=n.unusedAttackerUnits,o=n.untouchedDefenderUnits,d=n.defenderSurvivors,f=a({},function(e){var n=[],t=[],r=[],s=0,u=0;return e.forEach((function(e){e.attacker.newHp>0?n.push(a({},e.attacker)):t.push(a({},e.attacker)),0===e.defender.newHp&&r.push(a({},e.defender)),s+=e.attacker.attackDamage,u+=e.defender.defenseDamage})),{attackerSurvivors:n,attackersKilled:t,defendersKilled:r,totalAttackDamage:s,totalDefenseDamage:u}}(t),{unusedAttackerUnits:s,untouchedDefenderUnits:o,defenderSurvivors:d});e.push(t),e.push(f)})),c.sort((function(e,n){var t=e[3],a=t.attackerSurvivors.length+t.unusedAttackerUnits.length+t.defendersKilled.length-(t.defenderSurvivors.length+t.attackersKilled.length+t.untouchedDefenderUnits.length),r=n[3],s=r.attackerSurvivors.length+r.unusedAttackerUnits.length+r.defendersKilled.length-(r.defenderSurvivors.length+r.attackersKilled.length+r.untouchedDefenderUnits.length);return a!==s?s-a:r.totalAttackDamage-r.totalDefenseDamage-(t.totalAttackDamage-t.totalDefenseDamage)})),{battleResults:c[0][2],battleResultStatistics:c[0][3]}))}))}});